## Общая логика работы

1. При запуске приложение подключается к PostgreSQL.
2. Запускается HTTP-сервер на порту `8080`.
3. Все запросы обрабатываются через эндпоинт `/api/v0/prices`.

## POST /api/v0/prices?type=zip

**Назначение:** загрузка данных о ценах.

**Логика работы:**
1. Сервер принимает ZIP-архив с CSV-файлом
2. CSV извлекается из архива и полностью читается в память
3. Выполняется валидация всех строк
4. Некорректные записи отбрасываются
5. Валидные записи сохраняются в PostgreSQL в рамках транзакции
6. В рамках той же транзакции выполняется вставка валидных строк. Дубликаты не вставляются и считаются как количество строк, которые не были добавлены из-за конфликта
7. В ответе возвращается статистика

**Ответ содержит:**
- `total_count` — общее количество строк в CSV (без заголовка);
- `total_items` — количество валидных строк, успешно добавленных в текущей загрузке;
- `total_categories` — количество уникальных категорий в БД;
- `total_price` — суммарная стоимость в БД
- `duplicates_count` — количество валидных строк текущей загрузки, которые не были добавлены, потому что запись с такими параметрами уже существует в БД

## GET /api/v0/prices

**Назначение:** получение данных из базы.

**Поддерживаемые параметры:**
- `start` — дата начала периода
- `end` — дата окончания периода
- `min` — минимальная цена
- `max` — максимальная цена

Запрос возвращает ZIP-архив с файлом `data.csv`, сформированный с учётом указанных фильтров

## База данных

Используется PostgreSQL с таблицей `prices`.

Параметры подключения по умолчанию:
- порт: `5432`
- база данных: `project-sem-1`
- пользователь: `validator`
- пароль: `val1dat0r`

## Обновлено
добавил retry подключение к БД (connectWithRetry)
добавил структуру ответа и функции writeJSON/writePostError
разделил логику на отдельные функции (валидация отдельно, транзакция отдельно)
добавил поддержку фильтров в GET (start/end/min/max)
добавил обработку ошибок (rows.Err, cw.Error, Create/Write zip)

## Обновлено v2
убрал COUNT(*)
добавил уникальный индекс (name, category, price, create_date)
вставка через ON CONFLICT DO NOTHING
дубликаты не попадают в БД, считаются на этапе вставки
функция возвращает структуру вместо набора параметров

## Запуск
Если проект загружен через архив в практикуме- исправить _github, _env на .github и .env

```bash
docker compose up --build
